---
interface Props {
  targetISO: string;
  label?: string;
}

const { targetISO } = Astro.props;
---

<div
  data-countdown
  data-target={targetISO}
  class="mx-auto flex w-full items-center gap-2 border border-double border-white px-4 py-3"
>
  <p class="tracking-widest text-gray-300 font-hakushu">第七十五回筑駒文化祭まで</p>
  <div class="flex items-end justify-center gap-3 text-center">
    <p data-days class="text-2xl font-bold sm:text-3xl">00</p>
  </div>
  <p class="tracking-widest text-gray-300 font-hakushu">日</p>
</div>

<script>
  const roots = document.querySelectorAll("[data-countdown]");

  const pad = (value: number) => String(value).padStart(2, "0");

  roots.forEach((root) => {
    const targetText = root.getAttribute("data-target");
    const target = targetText ? new Date(targetText).getTime() : NaN;
    const daysEl = root.querySelector("[data-days]");

    if (!Number.isFinite(target) || !daysEl) {
      return;
    }

    const render = () => {
      const now = Date.now();
      const diff = Math.max(0, target - now);
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));

      daysEl.textContent = pad(days);
    };

    render();
    setInterval(render, 1000);
  });
</script>