---
import menuOpenImage from "../../assets/SVG/hamburger_open.svg";
import menuCloseImage from "../../assets/SVG/hamburger_close.svg";
import bgRawImage from "../../assets/SVG/header_background_partial.svg";
import HomeLogo from "./HomeLogo.astro";
import MobileMenuSection from "./MobileMenuSection.astro";
import MobileMenuItem from "./MobileMenuItem.astro";
import { getImage } from "astro:assets";
import MobileHeaderButton from "./MobileHeaderButton.astro";

const bgImage = await getImage({ src: bgRawImage });
---

<header
  class="relative flex justify-between bg-repeat lg:hidden"
  ,
  style=`background-image: url(${bgImage.src});`
>
  <HomeLogo />
  <MobileHeaderButton
    id="mobile-global-menu-open"
    imageSrc={menuOpenImage}
    ariaControls="mobile-global-menu"
    ariaExpanded="false"
    ariaLabel="メニューを開く"
  />
  <MobileHeaderButton
    id="mobile-global-menu-close"
    className="hidden"
    imageSrc={menuCloseImage}
    ariaControls="mobile-global-menu"
    ariaExpanded="true"
    ariaLabel="メニューを閉じる"
  />
</header>
<nav id="mobile-global-menu" class="fixed -z-10 hidden">
  <ul>
    {/* TODO: リンクは後で変える */}
    <MobileMenuSection title="各班紹介">
      <MobileMenuItem title="ステージ班" link="/kakuhansyoukai/stage" />
      <MobileMenuItem title="縁日班" link="/kakuhansyoukai/ennichi" />
    </MobileMenuSection>
    <MobileMenuSection title="ご協賛について">
      <MobileMenuItem title="ご協賛のお願い" link="/kyousan/onegai" />
      <MobileMenuItem title="協賛企業一覧" link="/kyousan/ichiran" />
    </MobileMenuSection>
    <MobileMenuSection title="メニュー">
      <MobileMenuItem title="食品班" link="/menu/syokuhin" />
      <MobileMenuItem title="喫茶班" link="/menu/kissa" />
    </MobileMenuSection>
    <MobileMenuSection title="タイムテーブル">
      <MobileMenuItem title="ステージ班" link="/timetable/stage" />
    </MobileMenuSection>
    <MobileMenuSection title="ご案内">
      <MobileMenuItem title="マップ" link="/goannai/map" />
    </MobileMenuSection>
  </ul>
</nav>

<script is:inline>
  const openButton = document.getElementById("mobile-global-menu-open");
  const closeButton = document.getElementById("mobile-global-menu-close");
  const menu = document.getElementById("mobile-global-menu");

  openButton?.addEventListener("click", () => {
    menu.classList.remove("hidden");
    menu.classList.remove("-z-10");
    openButton.classList.add("hidden");
    closeButton.classList.remove("hidden");
  });

  closeButton.addEventListener("click", () => {
    menu.classList.add("hidden");
    menu.classList.add("-z-10");
    closeButton.classList.add("hidden");
    openButton.classList.remove("hidden");
  });
</script>
